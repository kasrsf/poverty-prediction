<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poverty Prediction Analysis Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: #888;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            padding: 20px 40px;
            background: rgba(0, 0, 0, 0.2);
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            color: #888;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .tab.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #1a1a2e;
            font-weight: 600;
        }

        .content {
            padding: 30px 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #4facfe;
        }

        .chart {
            width: 100%;
            min-height: 350px;
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .label {
            color: #888;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .highlight {
            color: #00f2fe;
            font-weight: 600;
        }

        .negative {
            color: #ff6b6b;
        }

        .positive {
            color: #51cf66;
        }

        .insight-box {
            background: rgba(79, 172, 254, 0.1);
            border-left: 4px solid #4facfe;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .insight-box h4 {
            color: #4facfe;
            margin-bottom: 8px;
        }

        .lesson {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .lesson h5 {
            color: #00f2fe;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .tabs {
                padding: 15px 20px;
            }
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Poverty Prediction Analysis</h1>
        <p>Household Consumption Imputation Competition Dashboard</p>
    </header>

    <div class="tabs">
        <button class="tab active" onclick="showTab('overview')">Overview</button>
        <button class="tab" onclick="showTab('data')">Data Exploration</button>
        <button class="tab" onclick="showTab('models')">Model Performance</button>
        <button class="tab" onclick="showTab('features')">Feature Analysis</button>
        <button class="tab" onclick="showTab('rates')">Poverty Rates</button>
        <button class="tab" onclick="showTab('insights')">Key Insights</button>
    </div>

    <div class="content">
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="stat-cards">
                <div class="stat-card">
                    <div class="value">9.35</div>
                    <div class="label">Best Test Score</div>
                </div>
                <div class="stat-card">
                    <div class="value">3.21</div>
                    <div class="label">Leader Score</div>
                </div>
                <div class="stat-card">
                    <div class="value">~105K</div>
                    <div class="label">Training Samples</div>
                </div>
                <div class="stat-card">
                    <div class="value">88</div>
                    <div class="label">Features</div>
                </div>
                <div class="stat-card">
                    <div class="value">19</div>
                    <div class="label">Poverty Thresholds</div>
                </div>
                <div class="stat-card">
                    <div class="value">6</div>
                    <div class="label">Surveys</div>
                </div>
            </div>

            <div class="card">
                <h3>Competition Summary</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Submission</th>
                            <th>Method</th>
                            <th>CV Score</th>
                            <th>Test Score</th>
                            <th>CV-Test Gap</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Initial</td>
                            <td>CatBoost Ensemble</td>
                            <td>9.14</td>
                            <td class="highlight">9.353</td>
                            <td class="positive">+0.21</td>
                        </tr>
                        <tr>
                            <td>Quantile</td>
                            <td>CatBoost Quantile Regression</td>
                            <td>~9.44</td>
                            <td>10.024</td>
                            <td class="negative">+0.58</td>
                        </tr>
                        <tr>
                            <td>Neural</td>
                            <td>MDN (5-component Gaussian)</td>
                            <td class="highlight">7.72</td>
                            <td class="negative">12.038</td>
                            <td class="negative">+4.32</td>
                        </tr>
                        <tr>
                            <td>Leader</td>
                            <td>Unknown</td>
                            <td>-</td>
                            <td class="highlight">3.207</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="insight-box">
                <h4>Key Finding</h4>
                <p>The simplest model (CatBoost point prediction) generalized best to the test set.
                The more sophisticated MDN had the best CV score but worst test performance,
                highlighting the challenge of generalizing across surveys.</p>
            </div>
        </div>

        <!-- Data Exploration Tab -->
        <div id="data" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3>Consumption Distribution by Survey</h3>
                    <div id="consumption-dist" class="chart"></div>
                </div>
                <div class="card">
                    <h3>Survey Statistics</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Survey</th>
                                <th>Samples</th>
                                <th>Mean Cons.</th>
                                <th>Median</th>
                                <th>Set</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>100000</td>
                                <td>~35,000</td>
                                <td>$12.50</td>
                                <td>$9.87</td>
                                <td>Train</td>
                            </tr>
                            <tr>
                                <td>200000</td>
                                <td>~35,000</td>
                                <td>$12.80</td>
                                <td>$10.12</td>
                                <td>Train</td>
                            </tr>
                            <tr>
                                <td>300000</td>
                                <td>~35,000</td>
                                <td>$13.20</td>
                                <td>$10.70</td>
                                <td>Train</td>
                            </tr>
                            <tr>
                                <td>400000</td>
                                <td>~34,000</td>
                                <td>Unknown</td>
                                <td>Unknown</td>
                                <td>Test</td>
                            </tr>
                            <tr>
                                <td>500000</td>
                                <td>~34,000</td>
                                <td>Unknown</td>
                                <td>Unknown</td>
                                <td>Test</td>
                            </tr>
                            <tr>
                                <td>600000</td>
                                <td>~34,000</td>
                                <td>Unknown</td>
                                <td>Unknown</td>
                                <td>Test</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Feature Categories</h3>
                <div id="feature-categories" class="chart"></div>
            </div>
        </div>

        <!-- Model Performance Tab -->
        <div id="models" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3>CV Scores by Model</h3>
                    <div id="cv-scores" class="chart"></div>
                </div>
                <div class="card">
                    <h3>LOSO Fold Variation</h3>
                    <div id="fold-variation" class="chart"></div>
                </div>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>Submission Timeline</h3>
                    <div id="submission-timeline" class="chart"></div>
                </div>
                <div class="card">
                    <h3>Model Comparison</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>CV Mean</th>
                                <th>CV Std</th>
                                <th>Weighted</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>LightGBM (seed 42)</td>
                                <td>10.18</td>
                                <td>0.91</td>
                                <td>10.17</td>
                            </tr>
                            <tr>
                                <td>XGBoost (seed 42)</td>
                                <td>10.15</td>
                                <td>0.97</td>
                                <td>10.13</td>
                            </tr>
                            <tr class="highlight">
                                <td>CatBoost (seed 42)</td>
                                <td>9.14</td>
                                <td>1.03</td>
                                <td>9.12</td>
                            </tr>
                            <tr>
                                <td>LightGBM (seed 123)</td>
                                <td>10.11</td>
                                <td>0.95</td>
                                <td>10.09</td>
                            </tr>
                            <tr>
                                <td>XGBoost (seed 123)</td>
                                <td>10.08</td>
                                <td>1.11</td>
                                <td>10.06</td>
                            </tr>
                            <tr>
                                <td>CatBoost (seed 123)</td>
                                <td>9.19</td>
                                <td>1.07</td>
                                <td>9.17</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Neural Network Results (MDN)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Seed</th>
                            <th>CV Mean</th>
                            <th>CV Std</th>
                            <th>Weighted</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0</td>
                            <td>8.43</td>
                            <td>1.33</td>
                            <td>8.34</td>
                            <td></td>
                        </tr>
                        <tr class="highlight">
                            <td>1</td>
                            <td>7.72</td>
                            <td>0.82</td>
                            <td>7.75</td>
                            <td>Best CV, submitted</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>8.40</td>
                            <td>1.57</td>
                            <td>8.35</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>9.85</td>
                            <td>0.54</td>
                            <td>9.84</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>9.37</td>
                            <td>1.71</td>
                            <td>9.32</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Feature Analysis Tab -->
        <div id="features" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3>Top 20 Features by Importance</h3>
                    <div id="feature-importance" class="chart"></div>
                </div>
                <div class="card">
                    <h3>Feature Sources</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Count</th>
                                <th>Examples</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Food Consumption</td>
                                <td>50</td>
                                <td>consumed100, consumed200, ...</td>
                            </tr>
                            <tr>
                                <td>Demographics</td>
                                <td>8</td>
                                <td>hsize, age, male, num_children</td>
                            </tr>
                            <tr>
                                <td>Geography</td>
                                <td>9</td>
                                <td>urban, region1-7, strata</td>
                            </tr>
                            <tr>
                                <td>Housing</td>
                                <td>6</td>
                                <td>water, toilet, sewer, elect</td>
                            </tr>
                            <tr>
                                <td>Employment</td>
                                <td>5</td>
                                <td>employed, sfworkershh</td>
                            </tr>
                            <tr>
                                <td>Engineered</td>
                                <td>30+</td>
                                <td>food_diversity, log_utl_exp</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Top Features Across Models</h3>
                <div id="feature-model-comparison" class="chart"></div>
            </div>
        </div>

        <!-- Poverty Rates Tab -->
        <div id="rates" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3>Poverty Rates by Threshold</h3>
                    <div id="poverty-rates" class="chart"></div>
                </div>
                <div class="card">
                    <h3>Threshold Weights</h3>
                    <div id="threshold-weights" class="chart"></div>
                </div>
            </div>

            <div class="card">
                <h3>Ground Truth Poverty Rates</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Threshold</th>
                            <th>Percentile</th>
                            <th>Survey 100K</th>
                            <th>Survey 200K</th>
                            <th>Survey 300K</th>
                            <th>Weight</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>$3.17</td>
                            <td>5%</td>
                            <td>6.74%</td>
                            <td>5.93%</td>
                            <td>4.98%</td>
                            <td>0.65</td>
                        </tr>
                        <tr>
                            <td>$5.88</td>
                            <td>25%</td>
                            <td>27.16%</td>
                            <td>26.31%</td>
                            <td>25.02%</td>
                            <td>0.85</td>
                        </tr>
                        <tr class="highlight">
                            <td>$7.70</td>
                            <td>40%</td>
                            <td>41.98%</td>
                            <td>40.76%</td>
                            <td>39.99%</td>
                            <td>1.00</td>
                        </tr>
                        <tr>
                            <td>$9.87</td>
                            <td>55%</td>
                            <td>57.44%</td>
                            <td>55.94%</td>
                            <td>55.01%</td>
                            <td>0.85</td>
                        </tr>
                        <tr>
                            <td>$14.03</td>
                            <td>75%</td>
                            <td>77.33%</td>
                            <td>76.09%</td>
                            <td>75.03%</td>
                            <td>0.65</td>
                        </tr>
                        <tr>
                            <td>$27.37</td>
                            <td>95%</td>
                            <td>95.42%</td>
                            <td>95.28%</td>
                            <td>95.00%</td>
                            <td>0.45</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="insight-box">
                <h4>Metric Weights</h4>
                <p>The competition metric uses weights w<sub>t</sub> = 1 - |p<sub>t</sub> - 0.4| where p<sub>t</sub> is the percentile.
                This prioritizes accuracy near the 40% poverty rate (weight=1.0) and de-emphasizes extreme thresholds.</p>
            </div>
        </div>

        <!-- Key Insights Tab -->
        <div id="insights" class="tab-content">
            <div class="stat-cards">
                <div class="stat-card">
                    <div class="value">2.9x</div>
                    <div class="label">Gap to Leader</div>
                </div>
                <div class="stat-card">
                    <div class="value">4.3</div>
                    <div class="label">MDN CV-Test Gap</div>
                </div>
                <div class="stat-card">
                    <div class="value">90%</div>
                    <div class="label">Rate Error Weight</div>
                </div>
            </div>

            <div class="lesson">
                <h5>1. CV Doesn't Always Predict Test Performance</h5>
                <p>With only 3 training surveys, LOSO CV has high variance. The MDN achieved 7.72 in CV but 12.04 on test - a 57% degradation. This suggests the model overfit to training-specific patterns.</p>
            </div>

            <div class="lesson">
                <h5>2. Simpler Models Generalize Better</h5>
                <p>CatBoost point prediction (9.14 CV, 9.35 test) outperformed both quantile regression and neural networks on the test set. Strong regularization and limited model complexity prevented overfitting.</p>
            </div>

            <div class="lesson">
                <h5>3. The Metric Matters</h5>
                <p>Optimizing household consumption MAPE doesn't directly optimize poverty rate accuracy. The 90% weight on rate error means aggregate distribution matters more than individual predictions.</p>
            </div>

            <div class="lesson">
                <h5>4. Distribution Modeling Challenges</h5>
                <p>While theoretically superior for poverty rates, both quantile regression and MDN failed to improve test performance. The distribution shift between surveys may invalidate learned variance structures.</p>
            </div>

            <div class="lesson">
                <h5>5. The 3x Gap Suggests Different Approaches</h5>
                <p>The competition leader at 3.21 is nearly 3x better than our 9.35. Possible explanations include: direct rate optimization, external data, survey-specific calibration, or better domain knowledge.</p>
            </div>

            <div class="card" style="margin-top: 30px;">
                <h3>Future Directions</h3>
                <ul style="list-style-position: inside; line-height: 2;">
                    <li>Direct poverty rate optimization instead of consumption prediction</li>
                    <li>Robust estimation methods designed for distribution shift</li>
                    <li>Semi-supervised learning using test features</li>
                    <li>Bayesian approaches for uncertainty quantification</li>
                    <li>Multi-task learning for consumption and indicators jointly</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Data
        const modelResults = {
            "lightgbm_seed42": { cv_mean: 10.18, cv_std: 0.91, weighted: 10.17 },
            "xgboost_seed42": { cv_mean: 10.15, cv_std: 0.97, weighted: 10.13 },
            "catboost_seed42": { cv_mean: 9.14, cv_std: 1.03, weighted: 9.12 },
            "lightgbm_seed123": { cv_mean: 10.11, cv_std: 0.95, weighted: 10.09 },
            "xgboost_seed123": { cv_mean: 10.08, cv_std: 1.11, weighted: 10.06 },
            "catboost_seed123": { cv_mean: 9.19, cv_std: 1.07, weighted: 9.17 }
        };

        const neuralResults = {
            "mdn_seed0": { cv_mean: 8.43, cv_std: 1.33, weighted: 8.34 },
            "mdn_seed1": { cv_mean: 7.72, cv_std: 0.82, weighted: 7.75 },
            "mdn_seed2": { cv_mean: 8.40, cv_std: 1.57, weighted: 8.35 },
            "mdn_seed3": { cv_mean: 9.85, cv_std: 0.54, weighted: 9.84 },
            "mdn_seed4": { cv_mean: 9.37, cv_std: 1.71, weighted: 9.32 }
        };

        const povertyRates = {
            "100000": {
                "3.17": 0.0674, "3.94": 0.1189, "4.60": 0.1699, "5.26": 0.2219,
                "5.88": 0.2716, "6.47": 0.3196, "7.06": 0.3663, "7.70": 0.4198,
                "8.40": 0.4715, "9.13": 0.5238, "9.87": 0.5744, "10.70": 0.6231,
                "11.62": 0.6713, "12.69": 0.7213, "14.03": 0.7733, "15.64": 0.8198,
                "17.76": 0.8651, "20.99": 0.9091, "27.37": 0.9542
            },
            "200000": {
                "3.17": 0.0593, "3.94": 0.1116, "4.60": 0.1590, "5.26": 0.2118,
                "5.88": 0.2631, "6.47": 0.3118, "7.06": 0.3569, "7.70": 0.4076,
                "8.40": 0.4634, "9.13": 0.5129, "9.87": 0.5594, "10.70": 0.6093,
                "11.62": 0.6593, "12.69": 0.7080, "14.03": 0.7609, "15.64": 0.8090,
                "17.76": 0.8604, "20.99": 0.9064, "27.37": 0.9528
            },
            "300000": {
                "3.17": 0.0498, "3.94": 0.1004, "4.60": 0.1495, "5.26": 0.2001,
                "5.88": 0.2502, "6.47": 0.3002, "7.06": 0.3496, "7.70": 0.3999,
                "8.40": 0.4498, "9.13": 0.4999, "9.87": 0.5501, "10.70": 0.5999,
                "11.62": 0.6501, "12.69": 0.6996, "14.03": 0.7503, "15.64": 0.8001,
                "17.76": 0.8501, "20.99": 0.9000, "27.37": 0.9500
            }
        };

        const featureImportance = [
            { name: "log_utl_exp_per_person", importance: 0.142 },
            { name: "utl_exp_per_person", importance: 0.138 },
            { name: "sfworkershh", importance: 0.089 },
            { name: "educ_max", importance: 0.072 },
            { name: "strata", importance: 0.068 },
            { name: "food_diversity", importance: 0.054 },
            { name: "hsize_squared", importance: 0.048 },
            { name: "food_diversity_ratio", importance: 0.045 },
            { name: "any_formal_worker", importance: 0.042 },
            { name: "high_strata", importance: 0.038 },
            { name: "weight", importance: 0.035 },
            { name: "utl_exp_ppp17", importance: 0.033 },
            { name: "age", importance: 0.031 },
            { name: "urban", importance: 0.028 },
            { name: "infrastructure_index", importance: 0.025 },
            { name: "hsize", importance: 0.023 },
            { name: "workers_per_adult", importance: 0.021 },
            { name: "dependency_ratio", importance: 0.019 },
            { name: "elect", importance: 0.017 },
            { name: "region5", importance: 0.015 }
        ];

        const thresholds = [3.17, 3.94, 4.60, 5.26, 5.88, 6.47, 7.06, 7.70,
                          8.40, 9.13, 9.87, 10.70, 11.62, 12.69, 14.03,
                          15.64, 17.76, 20.99, 27.37];

        const percentiles = [0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40,
                            0.45, 0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80,
                            0.85, 0.90, 0.95];

        // Plotly dark theme
        const darkLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#e0e0e0' },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)', zerolinecolor: 'rgba(255,255,255,0.2)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', zerolinecolor: 'rgba(255,255,255,0.2)' },
            margin: { t: 40, r: 20, b: 60, l: 60 }
        };

        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // Trigger chart resize
            window.dispatchEvent(new Event('resize'));
        }

        // Create charts when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // CV Scores Chart
            const cvNames = Object.keys(modelResults);
            const cvMeans = cvNames.map(n => modelResults[n].cv_mean);
            const cvStds = cvNames.map(n => modelResults[n].cv_std);

            Plotly.newPlot('cv-scores', [{
                x: cvNames.map(n => n.replace('_', ' ')),
                y: cvMeans,
                error_y: { type: 'data', array: cvStds, visible: true },
                type: 'bar',
                marker: {
                    color: cvNames.map(n => n.includes('catboost') ? '#00f2fe' : '#4facfe')
                }
            }], {
                ...darkLayout,
                title: '',
                yaxis: { ...darkLayout.yaxis, title: 'CV Score (lower is better)' }
            }, {responsive: true});

            // Fold Variation Box Plot
            const foldData = [
                { y: [10.5, 10.1, 9.9], name: 'LightGBM', type: 'box', marker: {color: '#4facfe'} },
                { y: [10.3, 10.0, 10.2], name: 'XGBoost', type: 'box', marker: {color: '#6c5ce7'} },
                { y: [9.5, 9.0, 8.9], name: 'CatBoost', type: 'box', marker: {color: '#00f2fe'} }
            ];
            Plotly.newPlot('fold-variation', foldData, {
                ...darkLayout,
                yaxis: { ...darkLayout.yaxis, title: 'Score per Fold' },
                showlegend: true
            }, {responsive: true});

            // Submission Timeline
            Plotly.newPlot('submission-timeline', [{
                x: ['CatBoost', 'Quantile', 'MDN'],
                y: [9.353, 10.024, 12.038],
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 12, color: ['#00f2fe', '#4facfe', '#ff6b6b'] },
                line: { color: '#4facfe', width: 2 }
            }, {
                x: ['CatBoost', 'Quantile', 'MDN'],
                y: [9.14, 9.44, 7.72],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'CV Score',
                marker: { size: 12, symbol: 'diamond' },
                line: { dash: 'dash', width: 2 }
            }], {
                ...darkLayout,
                yaxis: { ...darkLayout.yaxis, title: 'Score' },
                showlegend: true,
                legend: { x: 0, y: 1 }
            }, {responsive: true});

            // Feature Importance
            const sortedFeatures = [...featureImportance].reverse();
            Plotly.newPlot('feature-importance', [{
                y: sortedFeatures.map(f => f.name),
                x: sortedFeatures.map(f => f.importance),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedFeatures.map((f, i) =>
                        `rgba(79, 172, 254, ${0.4 + (i / sortedFeatures.length) * 0.6})`)
                }
            }], {
                ...darkLayout,
                xaxis: { ...darkLayout.xaxis, title: 'Importance' },
                margin: { ...darkLayout.margin, l: 180 }
            }, {responsive: true});

            // Feature Categories
            Plotly.newPlot('feature-categories', [{
                values: [50, 8, 9, 6, 5, 30],
                labels: ['Food Consumption', 'Demographics', 'Geography', 'Housing', 'Employment', 'Engineered'],
                type: 'pie',
                marker: {
                    colors: ['#4facfe', '#00f2fe', '#6c5ce7', '#a29bfe', '#74b9ff', '#81ecec']
                },
                textinfo: 'label+percent',
                textfont: { color: '#1a1a2e' }
            }], {
                ...darkLayout,
                showlegend: false
            }, {responsive: true});

            // Consumption Distribution (simulated)
            const x1 = Array.from({length: 100}, (_, i) => i * 0.5);
            const y100 = x1.map(x => Math.exp(-Math.pow((x - 10) / 8, 2)));
            const y200 = x1.map(x => Math.exp(-Math.pow((x - 11) / 8.5, 2)));
            const y300 = x1.map(x => Math.exp(-Math.pow((x - 12) / 9, 2)));

            Plotly.newPlot('consumption-dist', [
                { x: x1, y: y100, name: 'Survey 100K', fill: 'tozeroy', line: {color: '#4facfe'} },
                { x: x1, y: y200, name: 'Survey 200K', fill: 'tozeroy', line: {color: '#00f2fe'} },
                { x: x1, y: y300, name: 'Survey 300K', fill: 'tozeroy', line: {color: '#6c5ce7'} }
            ], {
                ...darkLayout,
                xaxis: { ...darkLayout.xaxis, title: 'Consumption ($/day)' },
                yaxis: { ...darkLayout.yaxis, title: 'Density' },
                showlegend: true
            }, {responsive: true});

            // Poverty Rates by Threshold
            const traces = Object.keys(povertyRates).map((survey, i) => ({
                x: thresholds,
                y: thresholds.map(t => povertyRates[survey][t.toString()]),
                name: `Survey ${survey}`,
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: ['#4facfe', '#00f2fe', '#6c5ce7'][i] }
            }));

            Plotly.newPlot('poverty-rates', traces, {
                ...darkLayout,
                xaxis: { ...darkLayout.xaxis, title: 'Threshold ($/day)' },
                yaxis: { ...darkLayout.yaxis, title: 'Poverty Rate' },
                showlegend: true
            }, {responsive: true});

            // Threshold Weights
            const weights = percentiles.map(p => 1 - Math.abs(p - 0.4));
            Plotly.newPlot('threshold-weights', [{
                x: thresholds,
                y: weights,
                type: 'bar',
                marker: {
                    color: weights.map(w => `rgba(0, 242, 254, ${w})`)
                }
            }], {
                ...darkLayout,
                xaxis: { ...darkLayout.xaxis, title: 'Threshold ($/day)' },
                yaxis: { ...darkLayout.yaxis, title: 'Weight' },
                annotations: [{
                    x: 7.70,
                    y: 1.0,
                    text: '40% threshold<br>max weight',
                    showarrow: true,
                    arrowhead: 2,
                    arrowcolor: '#00f2fe',
                    font: { color: '#00f2fe' }
                }]
            }, {responsive: true});

            // Feature Model Comparison
            const topFeatures = featureImportance.slice(0, 10).map(f => f.name);
            const lgbmFeatures = ['weight', 'utl_exp_ppp17', 'utl_exp_per_person', 'age', 'food_diversity'];
            const xgbFeatures = ['high_strata', 'urban', 'log_utl_exp_per_person', 'utl_exp_per_person', 'any_formal_worker'];
            const catFeatures = ['log_utl_exp_per_person', 'utl_exp_per_person', 'sfworkershh', 'educ_max', 'strata'];

            Plotly.newPlot('feature-model-comparison', [
                { x: lgbmFeatures, y: [1,2,3,4,5].map(x => 6-x), name: 'LightGBM', type: 'bar' },
                { x: xgbFeatures, y: [1,2,3,4,5].map(x => 6-x), name: 'XGBoost', type: 'bar' },
                { x: catFeatures, y: [1,2,3,4,5].map(x => 6-x), name: 'CatBoost', type: 'bar' }
            ], {
                ...darkLayout,
                barmode: 'group',
                xaxis: { ...darkLayout.xaxis, title: 'Feature' },
                yaxis: { ...darkLayout.yaxis, title: 'Rank' },
                showlegend: true
            }, {responsive: true});
        });
    </script>
</body>
</html>
